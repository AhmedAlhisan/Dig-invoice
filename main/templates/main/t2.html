{% extends 'main/base.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    {% block style %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        .chart-container {
    position: relative;
    text-align: center; /* Center aligns the text */
}

.chart-description {
    position: absolute;
    width: 50px;
    bottom: 10px; /* Adjust as needed */
    left: 0;
    color: #27ae60; /* Choose a color that stands out but complements the chart */
    font-size: 16px; /* Adjust the font size as needed */
    font-weight: bold; /* Makes the text bold */
}

    </style>
    {% endblock %}
</head>
<body style="background-color: #333; color: #27ae60;">

    {% block header %}
    <!-- nav bar -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary p-4">
      <div class="container">
        
  
        
  
        <!-- MENU -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link " aria-current="page" href="{%url 'main:test' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'main:upload_invoice'%}"> DEMO </a>
            </li>
          
             
            <li><a class="nav-link active" aria-current="page" href="{%url 'main:t2'%}">Dashboard</a>
            </li>
  
          </ul>
          <div class="d-flex">
           <!-- Logo -->
        <a class="navbar-brand text-success" href="#"><strong> ZADK </strong></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
          </div>
        </div>
      </div>
    </nav>
    {% endblock %}

    
    
    {% block content %}
   


    <div style="margin-top: 50px;" class="container">
        <div class="row">
            {% for department, info in department_invoice_info.items %}
                <div class="col">
                    <div style="background-color: #2a2a2a; 
                                color: #ffffff; 
                                border-left: 5px solid rgb(41, 204, 151); 
                                padding: 10px;
                                margin-bottom: 10px;
                                border-radius: 5px;" class="card mb-3 widget-content bg-grow-early">
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left">
                                <div class="widget-heading"># Invoices {{ info.total }}</div>
                                <div class="widget-subheading">
                                    <ul>
                                        {% for invoice_type, count in info.types.items %}
                                            <li>{{ invoice_type }} : {{ count }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            <div class="widget-content-right">
                                <div style="color: rgb(41, 204, 151);" class="widget-numbers">
                                    <span><strong>{{ department }}</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
          <br>
          <br>
          <div class="row">
            <div class="col">
              
              <div class="chart-container">
                  
                  <canvas id="marketingBudgetChart" width="220" height="220"></canvas>
                  <p style="color: rgb(41, 204, 151);" class="chart-description">Marketing</p>
                  
              </div>
             
            </div>
            <div class="col">
              <div class="chart-container">
                  
                  <canvas id="ITbudget" width="220" height="220"></canvas>
                  <p style="color: rgb(41, 204, 151);" class="chart-description">IT</p>
                  
              </div>
            </div>
            <div class="col">
              <div class="chart-container">
                  
                  <canvas id="salesbudget" width="220" height="220"></canvas>
                  <p style="color: rgb(41, 204, 151);" class="chart-description">Sales</p>
                  
              </div>
            </div>
            
  
          </div>
         
          <br>
          <br>
          
        <div class="row">
            <div class="col">
                <canvas id="myChart"width="220" height="150"></canvas>
            </div>
            <div class="col">
                <canvas id="distchart"width="220" height="150"></canvas>
            </div>
          </div>


          <br>
          <br>
          <br>

          <div class="container">
            <h3 style="color: rgb(41, 204, 151); margin-left: 300px;">Financial Recommendations For All Departments</h3>
        
            <div class="row">
                {% for department in all_departments %}
                    <div class="col-md-4 my-3">
                        <div class="card text-white bg-dark h-100">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ department.department }}</h5>
                                <p class="card-text">{{ department.description | truncatechars:100 }}</p>
                                <button style="background-color: rgb(76, 132, 255);" class="btn  mt-auto" data-toggle="modal" data-target="#descriptionModal{{ forloop.counter }}">Read More</button>
                            </div>
                        </div>
                    </div>
        
                    <!-- Modal -->
                    <div class="modal fade" id="descriptionModal{{ forloop.counter }}" tabindex="-1" role="dialog" aria-labelledby="descriptionModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content bg-dark text-white">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="descriptionModalLabel">{{ department.department }} Details</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true" style="color: white;">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    {{ department.description }}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        
        
          <br>

   

       

      </div>
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function(){
        $('.department-item').click(function(event){
            event.preventDefault();
            var description = $(this).data('description');
            $('#departmentDescription').text(description);
            $('#descriptionCard').show();
        });
    });
</script>

      <script type="text/javascript">
        var parsedChartData = JSON.parse('{{ departments_json|safe }}');
        console.log(parsedChartData); // Debugging to see the structure
    
        // Extract labels (months) and datasets (department totals per month)
        var chartLabels = Object.keys(parsedChartData);
        var uniqueDepartments = new Set();
    
        // Find unique departments across all months
        chartLabels.forEach(function(month) {
            Object.keys(parsedChartData[month]).forEach(function(dept) {
                uniqueDepartments.add(dept);
            });
        });
    
        // Array of colors for the datasets
        var datasetColors = [
            'rgb(76, 132, 255)',
            'rgb(255, 76, 76)',
            'rgb(41, 204, 151)'
        ];
    
        // Create datasets for each department
        var chartDatasets = Array.from(uniqueDepartments).map(function(dept, index) {
            return {
                label: dept,
                data: chartLabels.map(function(month) {
                    return parsedChartData[month][dept] || 0;
                }),
                fill: false,
                borderColor: datasetColors[index % datasetColors.length],
                backgroundColor: datasetColors[index % datasetColors.length],
                borderWidth: 2,
                tension: 0.1 // Smooths the line
            };
        });
    
        // Chart.js configuration
        var chartConfiguration = {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: chartDatasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            fontColor: 'white'
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        };
    
        // Initialize the chart
        var ctxzero = document.getElementById('distchart').getContext('2d');
        new Chart(ctxzero, chartConfiguration);
    </script>
    
      
    <script type="text/javascript">
        var chartData = JSON.parse('{{ departments_json|safe }}');
        console.log(chartData);  // Debugging to see the structure
    
        // Extract labels (months) and datasets (department totals per month)
        const labels = Object.keys(chartData);
        const departments = new Set();
    
        // Find unique departments across all months
        labels.forEach(month => {
            Object.keys(chartData[month]).forEach(department => {
                departments.add(department);
            });
        });
    
        // Array of colors for the datasets
        const colors = [
            'rgb(76, 132, 255)',
            'rgb(255, 76, 76)',
            'rgb(41, 204, 151)'
        ];
    
        // Create datasets for each department
        const datasets = Array.from(departments).map((department, index) => {
            return {
                label: department,
                data: labels.map(month => chartData[month][department] || 0),
                backgroundColor: colors[index % colors.length], // Cycle through the colors array
                borderColor: colors[index % colors.length],
                borderWidth: 1
            };
        });
    
        // Chart.js configuration
        const config = {
            type: 'bar',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: 'white' // Here is the change for y-axis labels
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)' // Adjust the grid color as needed
                        }
                    },
                    x: {
                        ticks: {
                            color: 'white' // Here is the change for x-axis labels
                        },
                        grid: {
                            display: false // Typically, x-axis grid lines are not needed for bar charts
                        }
                    }
                }
            }
        };
    
        // Initialize the chart
        const ctxone = document.getElementById('myChart').getContext('2d');
        new Chart(ctxone, config);
    </script>
    
    
    


    
      <script>
        var budgetData = JSON.parse('{{ budget_data_sales_json|safe }}');
 
 var ctxtwo = document.getElementById('salesbudget').getContext('2d');
 var itBudgetChart = new Chart(ctxtwo, {
     type: 'doughnut',
     data: {
         labels: Object.keys(budgetData),
         datasets: [{
             data: Object.values(budgetData),
             backgroundColor: [
                 'rgb(76, 132, 255)', // Your custom color
                 'rgb(255, 76, 76)',       // Your custom color
                 'rgb(0, 230, 64)'         // Your custom color
                 // Add more colors if you have more data points
             ],
             borderColor: [
                 'rgb(76, 132, 255)', // Darker variant of your custom color
                 'rgb(255, 76, 76)',      // Same as backgroundColor as it's already opaque
                 'rgb(0, 230, 64)'        // Same as backgroundColor as it's already opaque
                 // Add more border colors if needed
             ],
             borderWidth: 1 // Set border width if you use borderColor
         }]
     },
     options: {
         responsive: true,
         maintainAspectRatio: false,
         title: {
             display: true,
             text: 'Marketing Department Budget'
         }
     }
 });
 
       </script>
      <script>
        var budgetData = JSON.parse('{{ budget_data_json|safe }}');
 
 var ctxthree = document.getElementById('ITbudget').getContext('2d');
 var itBudgetChart = new Chart(ctxthree, {
     type: 'doughnut',
     data: {
         labels: Object.keys(budgetData),
         datasets: [{
             data: Object.values(budgetData),
             backgroundColor: [
                 'rgb(76, 132, 255)', // Your custom color
                 'rgb(255, 76, 76)',       // Your custom color
                 'rgb(0, 230, 64)'         // Your custom color
                 // Add more colors if you have more data points
             ],
             borderColor: [
                 'rgb(76, 132, 255)', // Darker variant of your custom color
                 'rgb(255, 76, 76)',      // Same as backgroundColor as it's already opaque
                 'rgb(0, 230, 64)'        // Same as backgroundColor as it's already opaque
                 // Add more border colors if needed
             ],
             borderWidth: 1 // Set border width if you use borderColor
         }]
     },
     options: {
         responsive: true,
         maintainAspectRatio: false,
         title: {
             display: true,
             text: 'Marketing Department Budget',
             color: 'white'
         },
         legend: {
                    labels: {
                        color: 'white' // Set legend text color to white
                    }
                }
     }
 });
 
       </script>
      <script>
       var budgetData = JSON.parse('{{ budget_data_json_MRKT|safe }}');

var ctxfour = document.getElementById('marketingBudgetChart').getContext('2d');
var itBudgetChart = new Chart(ctxfour, {
    type: 'doughnut',
    data: {
        labels: Object.keys(budgetData),
        datasets: [{
            data: Object.values(budgetData),
            backgroundColor: [
                'rgb(76, 132, 255)', // Your custom color
                ' rgb(255, 76, 76)',       // Your custom color
                'rgb(0, 230, 64)'         // Your custom color
                // Add more colors if you have more data points
            ],
            borderColor: [
                'rgb(76, 132, 255)', // Darker variant of your custom color
                '  rgb(255, 76, 76)',      // Same as backgroundColor as it's already opaque
                'rgb(0, 230, 64)'        // Same as backgroundColor as it's already opaque
                // Add more border colors if needed
            ],
            borderWidth: 1 // Set border width if you use borderColor
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        title: {
            display: true,
            text: 'Marketing Department Budget'
        }
    }
});

      </script>
  
</body>
</html>
{% endblock %}